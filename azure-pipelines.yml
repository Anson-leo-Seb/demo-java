trigger:
- master

pool:
  vmImage: ubuntu-latest

variables:
  azureSubscription: 'ME-MngEnvMCAP482325-v-ansonse-1 (ffb8fed6-6921-49f0-8eb8-2e00a9000d9a)'
  appName: 'Java-webapp'
  packagePath: '$(System.DefaultWorkingDirectory)/**/*.war'

steps:
# Checkout source
- checkout: self

# Build WAR
- task: Maven@3
  inputs:
    mavenPomFile: 'pom.xml'
    goals: 'package'
    javaHomeOption: 'JDKVersion'
    jdkVersionOption: '1.11'

# Copy WAR to staging directory
- task: CopyFiles@2
  inputs:
    SourceFolder: '$(System.DefaultWorkingDirectory)'
    Contents: '**/*.war'
    TargetFolder: '$(Build.ArtifactStagingDirectory)'

# Publish WAR as downloadable build artifact
- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)'
    ArtifactName: 'war-package'
    publishLocation: 'Container'

# Deploy WAR to Azure Web App
- task: AzureWebApp@1
  inputs:
    azureSubscription: $(azureSubscription)
    appName: $(appName)
    package: '$(Build.ArtifactStagingDirectory)/*.war'
    appType: webAppLinux
