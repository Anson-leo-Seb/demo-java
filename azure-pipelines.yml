trigger:
- master

pool:
  vmImage: ubuntu-latest

variables:
  azureSubscription: 'ME-MngEnvMCAP482325-v-ansonse-1 (ffb8fed6-6921-49f0-8eb8-2e00a9000d9a)'
  appName: 'Java-webapp'
  packagePath: '$(System.DefaultWorkingDirectory)/**/*.war'

steps:
# Checkout source
- checkout: self

# Build WAR
- task: Maven@3
  inputs:
    mavenPomFile: 'pom.xml'
    goals: 'package'
    javaHomeOption: 'JDKVersion'
    jdkVersionOption: '1.11'

# Copy WAR to staging directory
- script: |
    echo "Listing contents of Artifact Staging Directory"
    ls -R "$(Build.ArtifactStagingDirectory)"
  displayName: "Debug WAR location"

- powershell: |
    $war = Get-ChildItem "$(Build.ArtifactStagingDirectory)/" -Filter *.war | Select-Object -First 1
    Rename-Item $war.FullName ROOT.war
  displayName: 'Rename WAR to ROOT.war'

- task: AzureWebApp@1
  inputs:
    appType: webAppLinux
    azureSubscription: $(azureSubscription)
    appName: $(appName)
    package: '$(Build.ArtifactStagingDirectory)/renamed/ROOT.war'
